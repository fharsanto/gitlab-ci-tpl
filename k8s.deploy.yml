variables:
  CI_HUB: hub.spesolution.com
  CI_DEPLOYMENT_FILE: deployment.yml 

docker_to_k8s:
  image: $CI_HUB/tools/kubectl:latest
  stage: deploy
  script:
    - echo "Deploy $CI_PROJECT_NAME to k8s ns $KUBE_NAMESPACE ..."
    - kubectl create secret generic $CI_PROJECT_NAME-env -n $KUBE_NAMESPACE --save-config --dry-run=client --from-env-file=<(compgen -v | grep -v '^CI\|^KUBE\|^GITLAB\|^DOCKER' | while read line; do echo $line=${!line};done) -o yaml | kubectl apply -f -
    - kubectl apply -f $CI_DEPLOYMENT_FILE -n $KUBE_NAMESPACE
    - kubectl rollout restart deployment/$CI_PROJECT_NAME -n $KUBE_NAMESPACE  
  environment:
    name: development
    url: https://sukangetik.com